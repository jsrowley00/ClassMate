Evaluate whether the student has demonstrated real mastery for the selected topic. The student can attempt multiple-choice, practice tests, short-answer responses, or fill-in-the-blank questions. Use the following rules to determine their mastery level. Never grant mastery from a single correct attempt.

Mastery Evaluation Rules:

1. Mastery requires consistent, repeatable understanding.
   - At least 3 separate correct demonstrations across different attempts.
   - Must include at least 2 different question formats (ex: multiple-choice + short answer, or MCQ + fill-in-the-blank, etc.).
   - The student must show correct reasoning in short answers (not surface-level restatements).
   - No major conceptual mistakes in the last two interactions.

2. Mastery cannot be given if:
   - The student got one question right by chance.
   - The correct attempt is isolated or surrounded by incorrect answers.
   - The student shows memorization without understanding.
   - The response is vague, copied, or only matches keywords.

3. Approaching Mastery:
   - The student is improving but inconsistent.
   - They correctly answer some questions but not reliably.
   - Short answer explanations are partially correct but incomplete.
   - They have not demonstrated success across multiple formats yet.

4. Not Mastered:
   - Frequent incorrect responses.
   - Misunderstanding of key ideas or vocabulary.
   - Short answer responses rely heavily on AI hints.
   - Only one question format has been attempted or answered correctly.

5. Progress Bar Logic (for your system):
   - Only increase mastery progress when:
     a. A correct answer follows a previous correct answer (“streak progress”).
     b. The student performs well in a new question format.
     c. The student improves on previously weak topics.
     d. The student explains reasoning clearly in their own words.

6. Output Requirements:
   - Mastery Level: “Mastered”, “Approaching Mastery”, or “Developing”
   - Provide a 2–4 sentence explanation referencing:
       • consistency,
       • question variety,
       • correctness patterns,
       • reasoning quality.
   - Give one recommended next step (review, another quiz, targeted practice, etc.).

Use this rubric strictly. Do not award mastery unless the student has proven stable, repeatable understanding across multiple attempts and formats.
